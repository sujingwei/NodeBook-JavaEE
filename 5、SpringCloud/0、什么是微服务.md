* 微服务的基础知识，SpringCloud介绍，注册中心，Ribbon
* Feign组件，hystrix熔断
* 微服务API网关，链路追踪
* 消息中间件处理，分布式配置中心

## 一、系统架构

### 1、单体应用

* 优点：用开发简单，适用于小型应用

* 缺点：不易拓展，维护。代码耦合

### 2、垂直应用架构

优点：

* 解决高并发问题
* 针对不同的模块优化
* 方便水平扩展

缺点：

* 系统间相互独立
* 重复开发工作

### 3、分布式架构

缺点：服务的评估，治理，高度

### 4、SOA框架

SOA全称为Service-Oriented Arthitecture，就是面向服务架构。它可以根据需求通过网络松散耦合的粗粒度应用组件（服务）进行分布式部署，组合和使用。一个服务通常以独立的形式存在于操作系统进程中。

站在功能的角度，把业务逻辑抽象成可复用、可组装的服务，通过服务的编排实现的快速再生，目的：把原先固有的业务功能转变为通用的业务服务，实现业务逻辑的快速复用。

通过上面的描述可以发现SOA有如下几个特点：分布式、可重用、扩展灵活、松耦合

如：ESB，Dubbo等框架

优点：

* 抽取公共的功能为服务，提高开发效率
* 对不同的服务进行集群化部署解决系统压力
* 基于ESB/DUBBO减少系统耦合

缺点：

* 抽取公共的功能为服务，降低开发效率
* 用户提供方与调用方接口耦合度较高

### 5、微服务架构

优点：

* 通过服务的原子化拆分，以及微服务的独立打包、部署和升级，小团队交付周期将缩短，运维成本也将大幅度下降
* 

* 微服务过多，服务治理成本高，不利于系统维护。
* 分布式系统开发的技术成本高(容错、分布式事务)。

| 功能     | SOA                  | 微服务                       |
| -------- | -------------------- | ---------------------------- |
| 组件大小 | 大块业务逻辑         | 单独任务或小块业务逻辑       |
| 耦合     | 通常松耦合           | 总是松耦合                   |
| 公司架构 | 任何类型             | 小型、专注于功能交叉团队     |
| 管理     | 着重中央管理         | 着重分散管理                 |
| 目标     | 确保应用能够交互操作 | 执行新功能、快速拓展开发团队 |
| 调用     | RPC                  | HTTP RestFul Api             |

## 二、系统架构的演变

### 1、远程调用

![远程调用](/img/58c701bc1ab990c0852f4001f38face.png)

流行的技术有两种：RPC、HTTP

#### 1）、PRC协议

![PRC](/img/df4d9b5bb3f6fed6be6550ab776f2a9.png)

PRC(Remote Procedure Call)一种进程间通信方式。允许像调用本地服务一样调用远程服务。PRC框架的主要目标就是让远程服务调用更简单、透明。PRC框架负责屏蔽底层的传输方式（TCP或UDP）、序列化方式和通信细节。开发人员在使用的时候只需了解谁在什么位置提供了会什么样的远程服务接口，不需要关心底层通信细节和调用过程。

#### 2）、Http协议

| 比较项   | Restful    | PRC     |
| -------- | ---------- | ------- |
| 通讯协议 | Http       | RPC     |
| 性能     | 略低       | 较高    |
| 灵活度   | 高         | 低      |
| 应用     | 微服务架构 | SOA架构 |

### 2、CAP原理

如今，对于大多数互联网应用，分布式系统正变得越来越重要。分布式系统的最大难点，就是各个节点的状态如何同步。CAP定理是这方面的定量，也是理解分布式系统的起点。

CAP理论由`Eric Brewer`在ACM研讨会上提出，而后CAP被奉为分布式领域的重要理论。分布式系统的CAP理论，首先把分布系统中的本个特性进行如下归纳：

![CAP原理](/img/1225990cce98221d54e8a5b1deb931b.png)

* A: 可用性，保持服务可用，多节点
* C：一致性，多个节点数据一致
* P：分区容忍性，是否可以将数据存到多个地方

## 三、Spring Cloud

<u>Spring Cloud</u>是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如**服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控**等，都可以用Spring Boot的开发风格做到一键启动和部署。Spring Cloud并没有重复制造轮子，它只是将目前各家分司比较成熟、经得起实际的服务框架组合起来，通过Spring Boot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出一套简单易懂、易部署和易维护的分布式系统开发工具包。

Spring Cloud Netflix组件

| 组件名称 | 作用           |
| -------- | -------------- |
| Eureka   | 服务注册中心   |
| Ribbon   | 客户端负载均衡 |
| Feign    | 声明式服务调用 |
| Hystrix  | 客户端容错保护 |
| Zuul     | API服务网关    |

Spring Cloud Alibaba组件

| 组件名称 | 作用           |
| -------- | -------------- |
| Nacos    | 服务注册中心   |
| Sentinel | 客户端容错保护 |

Spring Cloud原生及其他组件

| 组件名称      | 作用           |
| ------------- | -------------- |
| Consul        | 服务注册中心   |
| Config        | 分布式配置中心 |
| Gateway       | API服务网关    |
| Sleuth/Zipkin | 分布式链路追踪 |

