# Zookeeper的分布式锁

## 一、分布式锁的实现原理及羊群效应解释方案

### 1、普通的加锁方式如图：

![zookeeper的分布式锁](http://notebook-1.aoae.top/16038610495286)

这种方式会有羊群效应。假设当前有1000个线程在访问资源，其中只有1个线程得到锁，而执行业务逻辑。其它999个线程都在等待。当这个线程操作完成后，释放锁，那么监听这个节点的999个客户端线程就会同时收到通知。这样就会占用较大的资源来通知客户。

### 2、解决羊群效应的加锁方式：

<img src="http://notebook-1.aoae.top/16038620017000" alt="解决羊群效应的加锁方式" style="zoom:60%;" />

1. 请求进来，直接在/lock节点下创建一个临时顺序节点
2. 判断自己是不是lock节点下，最小的节点
   1. 是最小的，获得锁
   2. 不是。对**前面**的节点进行监听
3. 获得锁的请求，处理完释放锁(delete节点)，然后继续第一个节点将收到通知，重复第2步操作